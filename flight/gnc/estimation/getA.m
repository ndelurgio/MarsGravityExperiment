function Ad = getA(x,u,sunPos,Bsrp_c,Bsrp_d,dt,mu,J2,Re,AU,p_sr)

rc = x(1:3,1);
vc = x(4:6,1);
rd = x(7:9,1);
vd = x(10:12,1);
br = x(13:15,1);
bv = x(16:18,1);
bac = x(19:21,1);
bad = x(22:24,1);
r_sunx = sunPos(1,1);
r_suny = sunPos(2,1);
r_sunz = sunPos(3,1);


rx = rc(1,1);
ry = rc(2,1);
rz = rc(3,1);
r = sqrt(rx^2+ry^2+rz^2);
B = 3/2*J2*mu*Re^2;

rssx = r_sunx - rx;
rssy = r_suny - ry;
rssz = r_sunz - rz;
rss = sqrt(rssx^2+rssy^2+rssz^2);

K = -Bsrp_c * p_sr * AU^2;
A_c = [                                                                                                                                                                                                    0,                                                                                                                                                                                                     0,                                                                                                                                                                                                                0, 1, 0, 0
                                                                                                                                                                                                    0,                                                                                                                                                                                                     0,                                                                                                                                                                                                                0, 0, 1, 0
                                                                                                                                                                                                    0,                                                                                                                                                                                                     0,                                                                                                                                                                                                                0, 0, 0, 1
(3*K*rssx^2)/(rss^2)^(5/2) - mu/(r^2)^(3/2) - (B*(r^2 - 5*rz^2))/(r^2)^(7/2) - K/(rss^2)^(3/2) + (3*mu*rx^2)/(r^2)^(5/2) - (10*B*rx^2*rz^2)/(r^2)^(9/2) + (5*B*rx^2*(r^2 - 5*rz^2))/(r^2*(r^2)^(7/2)),                                                                 (3*K*rssx*rssy)/(rss^2)^(5/2) + (3*mu*rx*ry)/(r^2)^(5/2) - (5*B*rx*ry*((5*rz^2)/r^2 - 1))/(r^2)^(7/2) - (10*B*rx*ry*rz^2)/(r^2)^(9/2),                                                         (3*K*rssx*rssz)/(rss^2)^(5/2) - (B*rx*((10*rz^3)/r^4 - (10*rz)/r^2))/(r^2)^(5/2) + (3*mu*rx*rz)/(r^2)^(5/2) - (5*B*rx*rz*((5*rz^2)/r^2 - 1))/(r^2)^(7/2), 0, 0, 0
                                                                (3*K*rssx*rssy)/(rss^2)^(5/2) + (3*mu*rx*ry)/(r^2)^(5/2) - (5*B*rx*ry*((5*rz^2)/r^2 - 1))/(r^2)^(7/2) - (10*B*rx*ry*rz^2)/(r^2)^(9/2), (3*K*rssy^2)/(rss^2)^(5/2) - mu/(r^2)^(3/2) - (B*(r^2 - 5*rz^2))/(r^2)^(7/2) - K/(rss^2)^(3/2) + (3*mu*ry^2)/(r^2)^(5/2) - (10*B*ry^2*rz^2)/(r^2)^(9/2) + (5*B*ry^2*(r^2 - 5*rz^2))/(r^2*(r^2)^(7/2)),                                                         (3*K*rssy*rssz)/(rss^2)^(5/2) - (B*ry*((10*rz^3)/r^4 - (10*rz)/r^2))/(r^2)^(5/2) + (3*mu*ry*rz)/(r^2)^(5/2) - (5*B*ry*rz*((5*rz^2)/r^2 - 1))/(r^2)^(7/2), 0, 0, 0
                                                                   (3*K*rssx*rssz)/(rss^2)^(5/2) - (10*B*rx*rz^3)/(r^2)^(9/2) + (3*mu*rx*rz)/(r^2)^(5/2) - (5*B*rx*rz*((5*rz^2)/r^2 - 3))/(r^2)^(7/2),                                                                    (3*K*rssy*rssz)/(rss^2)^(5/2) - (10*B*ry*rz^3)/(r^2)^(9/2) + (3*mu*ry*rz)/(r^2)^(5/2) - (5*B*ry*rz*((5*rz^2)/r^2 - 3))/(r^2)^(7/2), -(3*B*r^4*(rss^2)^(5/2) + 35*B*rz^4*(rss^2)^(5/2) + K*rss^2*(r^2)^(9/2) - 3*K*rssz^2*(r^2)^(9/2) + mu*r^6*(rss^2)^(5/2) - 30*B*r^2*rz^2*(rss^2)^(5/2) - 3*mu*r^4*rz^2*(rss^2)^(5/2))/((r^2)^(9/2)*(rss^2)^(5/2)), 0, 0, 0];



rx = rd(1,1);
ry = rd(2,1);
rz = rd(3,1);
r = sqrt(rx^2+ry^2+rz^2);
B = 3/2*J2*mu*Re^2;

rssx = r_sunx - rx;
rssy = r_suny - ry;
rssz = r_sunz - rz;
rss = sqrt(rssx^2+rssy^2+rssz^2);

K = -Bsrp_d * p_sr * AU^2;
A_d = [                                                                                                                                                                                                    0,                                                                                                                                                                                                     0,                                                                                                                                                                                                                0, 1, 0, 0
                                                                                                                                                                                                    0,                                                                                                                                                                                                     0,                                                                                                                                                                                                                0, 0, 1, 0
                                                                                                                                                                                                    0,                                                                                                                                                                                                     0,                                                                                                                                                                                                                0, 0, 0, 1
(3*K*rssx^2)/(rss^2)^(5/2) - mu/(r^2)^(3/2) - (B*(r^2 - 5*rz^2))/(r^2)^(7/2) - K/(rss^2)^(3/2) + (3*mu*rx^2)/(r^2)^(5/2) - (10*B*rx^2*rz^2)/(r^2)^(9/2) + (5*B*rx^2*(r^2 - 5*rz^2))/(r^2*(r^2)^(7/2)),                                                                 (3*K*rssx*rssy)/(rss^2)^(5/2) + (3*mu*rx*ry)/(r^2)^(5/2) - (5*B*rx*ry*((5*rz^2)/r^2 - 1))/(r^2)^(7/2) - (10*B*rx*ry*rz^2)/(r^2)^(9/2),                                                         (3*K*rssx*rssz)/(rss^2)^(5/2) - (B*rx*((10*rz^3)/r^4 - (10*rz)/r^2))/(r^2)^(5/2) + (3*mu*rx*rz)/(r^2)^(5/2) - (5*B*rx*rz*((5*rz^2)/r^2 - 1))/(r^2)^(7/2), 0, 0, 0
                                                                (3*K*rssx*rssy)/(rss^2)^(5/2) + (3*mu*rx*ry)/(r^2)^(5/2) - (5*B*rx*ry*((5*rz^2)/r^2 - 1))/(r^2)^(7/2) - (10*B*rx*ry*rz^2)/(r^2)^(9/2), (3*K*rssy^2)/(rss^2)^(5/2) - mu/(r^2)^(3/2) - (B*(r^2 - 5*rz^2))/(r^2)^(7/2) - K/(rss^2)^(3/2) + (3*mu*ry^2)/(r^2)^(5/2) - (10*B*ry^2*rz^2)/(r^2)^(9/2) + (5*B*ry^2*(r^2 - 5*rz^2))/(r^2*(r^2)^(7/2)),                                                         (3*K*rssy*rssz)/(rss^2)^(5/2) - (B*ry*((10*rz^3)/r^4 - (10*rz)/r^2))/(r^2)^(5/2) + (3*mu*ry*rz)/(r^2)^(5/2) - (5*B*ry*rz*((5*rz^2)/r^2 - 1))/(r^2)^(7/2), 0, 0, 0
                                                                   (3*K*rssx*rssz)/(rss^2)^(5/2) - (10*B*rx*rz^3)/(r^2)^(9/2) + (3*mu*rx*rz)/(r^2)^(5/2) - (5*B*rx*rz*((5*rz^2)/r^2 - 3))/(r^2)^(7/2),                                                                    (3*K*rssy*rssz)/(rss^2)^(5/2) - (10*B*ry*rz^3)/(r^2)^(9/2) + (3*mu*ry*rz)/(r^2)^(5/2) - (5*B*ry*rz*((5*rz^2)/r^2 - 3))/(r^2)^(7/2), -(3*B*r^4*(rss^2)^(5/2) + 35*B*rz^4*(rss^2)^(5/2) + K*rss^2*(r^2)^(9/2) - 3*K*rssz^2*(r^2)^(9/2) + mu*r^6*(rss^2)^(5/2) - 30*B*r^2*rz^2*(rss^2)^(5/2) - 3*mu*r^4*rz^2*(rss^2)^(5/2))/((r^2)^(9/2)*(rss^2)^(5/2)), 0, 0, 0];



A = [A_c, zeros(6,6), zeros(6,12);
     zeros(6,6), A_d, zeros(6,12);
     zeros(12,8), zeros(12,8), zeros(12,8)];
Ad = eye(24,24) + dt*A;

end
